<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tprrt's Blog | articles tagged "riot-os"</title>
    <link rel="shortcut icon" type="image/png" href="https://tprrt.tupi.fr/favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://tprrt.tupi.fr/favicon.ico">
    <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Tprrt's Blog Full Atom Feed" />
    <link href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Tprrt's Blog Full RSS Feed" />
    <link rel="stylesheet" href="https://tprrt.tupi.fr/theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="https://tprrt.tupi.fr/theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="https://tprrt.tupi.fr/theme/css/print.css" type="text/css" media="print" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="Thomas Perrot" />

    <script data-ad-client="ca-pub-8632147971669760"
            async="async"
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
            integrity="sha256-H0yTZ/g80w4995dyBRDArJlCXWcYuBANtPbA82uyu00="
            crossorigin="anonymous">
    </script>
</head>
<body>
    <header>
        <nav>
            <ul>
                <li class="ephemeral selected"><a href="https://tprrt.tupi.fr/tag/riot-os.html">riot-os</a></li>
                <li><a href="https://tprrt.tupi.fr/">Home</a></li>
                <li><a href="contributions">Contributions</a></li>
                <li><a href="archives">Archives</a></li>
                <li><a href="categories">Categories</a></li>
                <li><a href="contact">Contact</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="https://tprrt.tupi.fr/">Tprrt's Blog</a></h1>
            <h2>Yet another blog about embedded Linux, the open source and hardware</h2>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Sep 27, 2020</h4>

            <article class="post">
                <h2 class="title">
                    <a href="https://tprrt.tupi.fr/build-riot-oswith-podman.html" rel="bookmark" title="Permanent Link to &quot;Build RIOT-OS with Podman&quot;">Build RIOT-OS with Podman</a>
                </h2>

                
                

                <div class="section" id="summary">
<h2>Summary</h2>
<p>This article is a tip that explains how it is possible to build a <a class="reference external" href="https://github.com/RIOT-OS/RIOT">RIOT-OS</a>
application with <a class="reference external" href="https://podman.io">Podman</a> and the official build container. And I would like to
take this opportunity to introduce you to <a class="reference external" href="https://podman.io">Podman</a> and <a class="reference external" href="https://github.com/RIOT-OS/RIOT">RIOT-OS</a>.</p>
</div>
<div class="section" id="podman">
<h2>Podman</h2>
<p>Some Linux distribution, like <a class="reference external" href="https://getfedora.org">Fedora</a> chosen to officially only support
<a class="reference external" href="https://podman.io">Podman</a> instead of <a class="reference external" href="https://www.docker.com">Docker</a> for some available reason:</p>
<ul class="simple">
<li>It is daemonless container engine.</li>
<li>It is rootless.</li>
<li>It follows Open Container Initiative (<a class="reference external" href="https://opencontainers.org">OCI</a>) standards.</li>
<li>It is safer than the <a class="reference external" href="https://www.docker.com">Docker</a> engine.</li>
<li>It introduces the notion of <a class="reference external" href="https://kubernetes.io/docs/concepts/workloads/pods">Pods</a>: a group of container(s) that share storage
or network resources.</li>
</ul>
<p>Moreover, <a class="reference external" href="https://podman.io">Podman</a> is able to use the images built by the <a class="reference external" href="https://www.docker.com">Docker</a> engine and
has been stored in <a class="reference external" href="https://www.docker.com">Docker</a> registry.</p>
<p>However, most of the time the <a class="reference external" href="https://podman.io">Podman</a> commands are identical to that of
<a class="reference external" href="https://www.docker.com">Docker</a>, the a simple alias is enough to be misleading:
<em>alias docker=podman</em>.</p>
<p>But as <a class="reference external" href="https://podman.io">Podman</a> is rootless and safer than <a class="reference external" href="https://www.docker.com">Docker</a>, then sometimes it is
necessary to specify additional security parameters.</p>
</div>
<div class="section" id="riot-os">
<h2>RIOT-OS</h2>
<p><a class="reference external" href="https://github.com/RIOT-OS/RIOT">RIOT-OS</a> is a memory-constrained <a class="reference external" href="https://en.wikipedia.org/wiki/Real-time_operating_system">RTOS</a>, such as <a class="reference external" href="https://en.wikipedia.org/wiki/Contiki">Contiki</a>, that provides
real-time and multithreading abilities, and it runs on processors from 8bits to
32bits.</p>
<p>It was designed for <a class="reference external" href="https://en.wikipedia.org/wiki/Internet_of_things">IoT</a> devices then to be low power consumption and it
provides three very complete network stacks including some protocols as:</p>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/IPv6">IPv6</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/6LoWPAN">6LoWPAN</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Constrained_Application_Protocol">CoAP</a></li>
<li>etc.</li>
</ul>
<p>The <a class="reference external" href="https://github.com/RIOT-OS/RIOT">RIOT-OS</a> project also provides some useful tools including a build
container (<a class="reference external" href="https://github.com/RIOT-OS/riotdocker">riotdocker</a>).</p>
<p>And the build environment of <a class="reference external" href="https://github.com/RIOT-OS/RIOT">RIOT-OS</a> offers a <a class="reference external" href="https://en.wikipedia.org/wiki/Makefile">Makefile</a> to build an
application with this container simply by setting the variable <em>BUILD_IN_DOCKER</em>
to  <em>1</em>. Then the prebuilt image is downloaded and instantiated to execute the
<a class="reference external" href="https://en.wikipedia.org/wiki/Make_(software)">make</a> command.</p>
<p>By default, this feature is configured to be used with the <a class="reference external" href="https://www.docker.com">Docker</a> engine,
but it is possible to override some variables from the build environment
either to use a custom prebuilt image, either use another engine or to use
custom engine parameters.</p>
<p>Then here, we will use these environments variable to instantiate a container
with <a class="reference external" href="https://podman.io">Podman</a> (instead of <a class="reference external" href="https://www.docker.com">Docker</a>) and with the required parameters.</p>
</div>
<div class="section" id="tip-of-the-day">
<h2>Tip of the day</h2>
<p>In the following example, we build the Helloworld application for a STM32
Discovery board.
To do that we specify the engine by setting the variable <em>DOCKER</em> to the value
<em>podman</em>. The variable <em>DOCKER_USER</em> is set empty because in the variable
<em>DOCKER_RUN_FLAGS</em> the parameter <em>--userns</em> is set to <em>keep-id</em> to map the
uid:gid of the current rootless user (from host) with the values that will be
used into the container.</p>
<div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">BUILD_IN_DOCKER</span><span class="o">=</span><span class="m">1</span>
<span class="nb">export</span> <span class="nv">DOCKER</span><span class="o">=</span><span class="s2">&quot;podman&quot;</span>
<span class="nb">export</span> <span class="nv">DOCKER_USER</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nb">export</span> <span class="nv">DOCKER_RUN_FLAGS</span><span class="o">=</span><span class="s2">&quot;--rm -i -t --security-opt seccomp=unconfined --security-opt label=disable --userns=keep-id&quot;</span>
<span class="nb">export</span> <span class="nv">DOCKER_MAKE_ARGS</span><span class="o">=</span><span class="s2">&quot;-j</span><span class="k">$(</span>nproc<span class="k">)</span><span class="s2">&quot;</span>

make <span class="nv">BOARD</span><span class="o">=</span>stm32l476g-disco
Launching build container using image <span class="s2">&quot;riot/riotbuild:latest&quot;</span>.
podman run --rm -i -t --security-opt <span class="nv">seccomp</span><span class="o">=</span>unconfined --security-opt <span class="nv">label</span><span class="o">=</span>disable --userns<span class="o">=</span>keep-id -v <span class="s1">&#39;/usr/share/zoneinfo/Europe/Paris:/etc/localtime:ro&#39;</span> -v <span class="s1">&#39;/home/tperrot/dev/tprrt/pwm-ramp-gen/RIOT:/data/riotbuild/riotbase:delegated&#39;</span> -e <span class="s1">&#39;RIOTBASE=/data/riotbuild/riotbase&#39;</span> -e <span class="s1">&#39;CCACHE_BASEDIR=/data/riotbuild/riotbase&#39;</span> -e <span class="s1">&#39;BUILD_DIR=/data/riotbuild/riotbase/build&#39;</span> -v <span class="s1">&#39;/home/tperrot/dev/tprrt/pwm-ramp-gen:/data/riotbuild/riotproject:delegated&#39;</span> -e <span class="s1">&#39;RIOTPROJECT=/data/riotbuild/riotproject&#39;</span> -e <span class="s1">&#39;RIOTCPU=/data/riotbuild/riotbase/cpu&#39;</span> -e <span class="s1">&#39;RIOTBOARD=/data/riotbuild/riotbase/boards&#39;</span> -e <span class="s1">&#39;RIOTMAKE=/data/riotbuild/riotbase/makefiles&#39;</span>     -v <span class="s1">&#39;/home/tperrot/dev/tprrt/pwm-ramp-gen/.git:/home/tperrot/dev/tprrt/pwm-ramp-gen/.git:delegated&#39;</span> -e <span class="s1">&#39;BOARD=stm32l476g-disco&#39;</span>  -w <span class="s1">&#39;/data/riotbuild/riotproject/&#39;</span> <span class="s1">&#39;riot/riotbuild:latest&#39;</span> make <span class="s1">&#39;BOARD=stm32l476g-disco&#39;</span>   -j8
Building application <span class="s2">&quot;hello-world&quot;</span> <span class="k">for</span> <span class="s2">&quot;stm32l476g-disco&quot;</span> with MCU <span class="s2">&quot;stm32&quot;</span>.

<span class="o">[</span>INFO<span class="o">]</span> cloning stm32cmsis
fatal: not a git repository: /data/riotbuild/riotbase/../.git/modules/RIOT
Cloning into <span class="s1">&#39;/data/riotbuild/riotbase/cpu/stm32/include/vendor/cmsis/l4&#39;</span>...
remote: Enumerating objects: <span class="m">364</span>, <span class="k">done</span>.
remote: Counting objects: <span class="m">100</span>% <span class="o">(</span><span class="m">364</span>/364<span class="o">)</span>, <span class="k">done</span>.
remote: Compressing objects: <span class="m">100</span>% <span class="o">(</span><span class="m">71</span>/71<span class="o">)</span>, <span class="k">done</span>.
remote: Total <span class="m">364</span> <span class="o">(</span>delta <span class="m">309</span><span class="o">)</span>, reused <span class="m">344</span> <span class="o">(</span>delta <span class="m">289</span><span class="o">)</span>, pack-reused <span class="m">0</span>
Receiving objects: <span class="m">100</span>% <span class="o">(</span><span class="m">364</span>/364<span class="o">)</span>, <span class="m">709</span>.56 KiB <span class="p">|</span> <span class="m">561</span>.00 KiB/s, <span class="k">done</span>.
Resolving deltas: <span class="m">100</span>% <span class="o">(</span><span class="m">309</span>/309<span class="o">)</span>, <span class="k">done</span>.
HEAD is now at e442c72 Release v1.6.1
<span class="o">[</span>INFO<span class="o">]</span> updating stm32cmsis /data/riotbuild/riotbase/cpu/stm32/include/vendor/cmsis/l4/.pkg-state.git-downloaded
<span class="nb">echo</span> e442c72651e8d4757f6562acc14da949644944ce   &gt; /data/riotbuild/riotbase/cpu/stm32/include/vendor/cmsis/l4/.pkg-state.git-downloaded
<span class="o">[</span>INFO<span class="o">]</span> patch stm32cmsis
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/boards/stm32l476g-disco
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/core
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/cpu/stm32
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/drivers
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/sys
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/cpu/cortexm_common
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/cpu/stm32/periph
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/drivers/periph_common
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/cpu/stm32/stmclk
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/sys/auto_init
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/cpu/cortexm_common/periph
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/cpu/stm32/vectors
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/sys/malloc_thread_safe
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/sys/newlib_syscalls_default
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/sys/pm_layered
<span class="s2">&quot;make&quot;</span> -C /data/riotbuild/riotbase/sys/stdio_uart
   text    data     bss     dec     hex filename
   <span class="m">8900</span>     <span class="m">112</span>    <span class="m">2300</span>   <span class="m">11312</span>    2c30 /data/riotbuild/riotproject/bin/stm32l476g-disco/hello-world.elf
</pre></div>
</div>

                <div class="clear"></div>

                <div class="info">
                    <a href="https://tprrt.tupi.fr/build-riot-oswith-podman.html">posted at 13:01</a>
                    &nbsp;&middot;&nbsp;<a href="https://tprrt.tupi.fr/category/riot-os.html" rel="tag">riot-os</a>
                    &nbsp;&middot;
                    &nbsp;<a href="https://tprrt.tupi.fr/tag/container.html" class="tags">container</a>
                    &nbsp;<a href="https://tprrt.tupi.fr/tag/podman.html" class="tags">podman</a>
                    &nbsp;<a href="https://tprrt.tupi.fr/tag/riot-os.html" class="tags selected">riot-os</a>
                </div>
            </article>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
                &middot;
                <a href="https://tprrt.tupi.fr/feeds/all.atom.xml" rel="alternate">Atom Feed</a>
                &middot;
                <a href="https://tprrt.tupi.fr/feeds/all.rss.xml" rel="alternate">Rss Feed</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-169118252-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>
</body>
</html>